{% extends "base.html" %}
{% block content %}

<div class="products-container container-fluid">
    <form id="searchProducts" class="form-inline my-2 my-lg-0" action="{{ url_for('search')}}" method="POST">
        <input class="form-control mr-sm-2" type="text" name="query" value="{{ query }}" placeholder="Search"
            aria-label="Search">
        <button id="searchBtn" class="btn btn-sm my-2 px-2 my-sm-0" type="submit">Search</button>
    </form>


    {% if query %}
    {% if results >= 1 %}
    <h2 class="category-header">Your search for '{{ query }}' returned {{ results }} results</h2>
    {% endif %}
    {% endif %}

    <h2 class="category-header">Products</h2>

    {% for product in products %}
    <div id="product" class="card product-card mb-3 col-md-12">
        <div class="row">
            <div class="col-md-5">
                <img src="{{ product.img_url }}" class="card-img product-image" alt="{{ product.product_name }}">
            </div>
            <div class="col-md-7">
                <div id="product-info" class="product-text card-body text-justify">
                    {% if session.user|lower %}
                        <a href="{{url_for('favourites', product_id=product._id)}}" class="btn heart btn-lg active"
                            role="button" aria-pressed="true" data-toggle="tooltip" data-placement="left"
                            title="Add to Favourites"><i class="far fa-heart"></i>
                        </a>
                    {% endif %}
                    <h4 class=" product-brand card-title">{{ product.brand }}</h4>
                    <h4 class="product-brand card-title">{{ product.category_name }}</h4>
                    <h4 class="product-name card-title">{{ product.product_name }}</h4>
                    {% for rating in ratings %}
                        <!-- only apply if the product._id matches the rating._id -->
                        {% if product._id == rating._id %}
                            <!-- set variable "count" to the leftover value deducted from rating.average -->
                            {% set count = (5 - rating.average|int) if ".5" not in rating.average|string else (4 - rating.average|int) %}
                            <!-- for each star in the rating.average, insert whole-star -->
                            {% for star in range(rating.average|int) %}
                                <i id="star" class="fas fa-star"></i>
                            {% endfor %}
                            <!-- for each half-star in rating.average, insert half-star -->
                            {% if ".5" in rating.average|string %}
                                <i class="fas fa-star-half-alt"></i>
                            {% endif %}
                            <!-- for each remaining value in "count" variable, insert empty-star -->
                            {% for star in range(count) %}
                                <i id="star" class="far fa-star"></i>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                    <!-- if product has no reviews, set 5 empty stars -->
                    {% if product._id not in has_rating %}
                        {% for star in range(5) %}
                            <i id="star" class="far fa-star"></i>
                        {% endfor %}
                    {% endif %}
                    <p id="product-shades" class="card-text">
                        <strong>Shades: </strong> {{ product.num_shades }}
                    </p>
                    <span id="product-price" class="card-text">
                        <strong>Price: </strong>
                        â‚¬{{ product.price }}
                    </span>
                    <div>
                        <a href="{{ url_for('product_info', product_id=product._id) }}" type="button"
                            class="btn btn-lg review-btn" id="product-reviews">
                            More Info...
                        </a>
                        {% if session.user|lower == "admin"|lower %}
                        <a href="{{ url_for('edit_product', product_id=product._id) }}" type="button"
                            class="btn btn-lg review-btn" id="edit_product">
                            Edit Product
                        </a>
                        <a id="delete_product" data-href="{{ url_for('delete_product', product_id=product._id) }}"
                            type="button" class="product_delete btn btn-lg review-btn" id="delete_product">
                            Delete Product
                        </a>
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}
</div>


{% endblock %}